<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <title>assembler puzzles</title>
 <meta name="keywords" content="puzzles, assembler, linux, x86, assembly, programming">
 <meta name="description" content="puzzles with answers">
 <meta name="robots" content="NOINDEX NOFOLLOW">
<!-- ==================== -->
  <link rel="stylesheet" href="stylej.css" type="text/css">
<!-- ==================== -->
        <!-- main layout table -->
</head>

</head>
<body>
<table style="width: 100%;" border="0" cellpadding="10" cellspacing="0">
  <tbody>
    <tr valign="top">
<!-- ###########################-->
<!-- ### left menubar cell #####-->
<!-- ###########################--> <td
 class="menuleft"
 style="vertical-align: top; white-space: nowrap;">
      <div align="center"><img alt="LinuxAsmTools"
 src="logo.jpg" style="width: 110px; height: 120px;">
      <br>LinuxAsmTools<br>
      </div>
      <p  style="font-weight: bold;">
      <a href="new.html">What's New</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="program.html">Programs</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="libraries.html">Libraries</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="download.html">Downloads</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="puzzle.html">Puzzles</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="opinion.html">Opinion</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="tips.html">Tips,Tutors</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="sff.html">SFF Guideline</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="about.html">About</a><br>
      </p>
      <p style="font-weight: bold;">
      <a href="links.html">Links</a><br>
      </p>
  </td>
<!-- ######################--><!-- ### content cell #####--><!-- ######################-->
      <td width="100%"><!-- header here --><span
 style="font-weight: bold;">LinuxAsmTools
- Puzzles<img alt="puzzle" src="puzzles.jpg"
 style="width: 44px; height: 52px;" align="right" hspace="20"><br>
      <br>
      <br>
      <br>
      </span>
      <hr class="content" noshade="noshade"><!-- begin content here -->&nbsp;
      <br>
&nbsp; Classical Puzzle 1 - Doubly linked list<br>
      <br>
      <br>
We want to create a doubly linked list that can be traversed forwards
or backwards.&nbsp; Our list must have the minimum amount of
overhead.&nbsp; Only one dword is allowed for the headers.&nbsp; The
function to traverse this list must work in either direction and use 6
instructions or less.<br>
The calling sequence is:&nbsp; <br>
      <br>
&nbsp; mov edi,(current link address)<br>
&nbsp; mov esi,(previous link address or&nbsp; zero if start of chain)<br>
&nbsp; call&nbsp; traverse&nbsp; ;returns eax=next link, esi,edi
unchanged<br>
&nbsp; (when end of chain is encountered our function returns zero)<br>
      <br>
What code would traverse this list?&nbsp; <br>
      <br>
This puzzle has been solved by:&nbsp; <br>
&nbsp;&nbsp;&nbsp; 1.
Gabriel Ivancescu (Bidirectional)<br>
&nbsp;&nbsp;&nbsp;
2.<br>
      <br>
      <a href="#Doubly_linked_list">see answer</a><br>
      <br>
      <hr style="width: 100%; height: 2px;"><br>
Classical Puzzle 2 - Shared memory<br>
      <br>
&nbsp; <br>
Two processes are created with a shared memory area.&nbsp; At the top
of the memory is a (dword) flag to control access.&nbsp; Each process
must
checkout the memory area by setting the flag to one before they can
access it.&nbsp; When they are done the flag is set to zero.&nbsp; This
is a classical problem and the flag is called a semiphore.<br>
      <br>
Intel has implemented two instructions that are suited to checking and
setting the flag.&nbsp; It is possible to interrogate and set the flag
without turning off interrupts.&nbsp; Write two code fragemnts using
different instructions to check and set the flag.&nbsp; Each fragment
will check the flag and if not already set, it will set the flag.<br>
      <br>
Hint: Historically this has been a very difficult problem and can get
complicated.&nbsp;&nbsp; In our&nbsp; puzzle&nbsp; we assume a&nbsp;
simple single processor&nbsp; application.&nbsp; The code fragment is
less than three instructions.<br>
      <br>
This puzzle was on the web page for 6 months and not solved.&nbsp; The
basic principles and<br>
instructions are often discussed, but no could come up with the code?
Very puzzling.<br>
      <br>
&nbsp;<a href="#Shared_Memory">see answer</a><br>
      <br>
      <hr style="width: 100%; height: 2px;">&nbsp;<br>
&nbsp; Guru Puzzle 1 -&nbsp; Ascii conversion<br>
      <br>
Conversion of a binary value to decimal ascii for display is a very
common
operation.&nbsp; Typically,&nbsp; the binary value is divided by ten
and a remainder is used to form one ascii character.&nbsp; This
algrothm produces the ascii in the wrong order and it must be reversed
before sending to the display or printer.&nbsp; What is the shortest
routine to produce a left justified decimal ascii string from the value
in EAX?<br>
      <br>
&nbsp;The calling sequence of this function is:<br>
&nbsp;&nbsp;&nbsp; mov&nbsp; eax,(value)<br>
&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp; edi,(storage adr)<br>
&nbsp;&nbsp;&nbsp;&nbsp; call&nbsp;&nbsp;&nbsp; to_ascii<br>
&nbsp;(we can assume the direction flag is set to CLD state)<br>
      <br>
&nbsp; This puzzle was on the web page for 6 months and not solved<br>
      <br>
&nbsp;<a href="#Ascii_Conversion_">see answer</a><br>
      <br>
      <hr style="width: 100%; height: 2px;">Guru Puzzle
2 -
shortest sort<br>
      <br>
2. What is the shortest function to sort an array of dwords?&nbsp; The
calling sequence for our function will be:<br>
      <br>
&nbsp; mov edi,(array address)<br>
&nbsp; mov ecx,(number of elements in array)<br>
&nbsp; call&nbsp; sort<br>
      <br>
A possible starting point is the <a href="#Guru_Puzzle_2_information">AsmLib
bubble sort program</a>.<br>
      <br>
This puzzle was on the web page for 5 months and never solved<br>
      <br>
      <a href="#shortest_sort">see answer</a> <br>
      <br>
      <hr style="width: 100%; height: 2px;"><br>
      <br>
      <style="font-weight: bold;="">Guru Puzzle 3 - Bill Gates
Destroys Linux<br>
      <br>
Bill Gates has spent the last year working on a virus to<br>
destroy Linux. To complete his virus he needs the constant<br>
of -4 in eax. His virus hides in the ELF header and at this<br>
point he only has 2 bytes of program space left. All his<br>
general registers are zero.<br>
      <br>
How does Bill generate -4 in two bytes of code?<br>
      <br>
&nbsp;<a href="#Bill_Gates_Puzzle">see answer</a><br>
      <br>
      </style="font-weight:>
      <hr style="width: 100%; height: 2px;"><br>
      <br>
      <style="font-weight: bold;="">Guru Puzzle 4 = Microsoft Attacks<br>
      <br>
Microsoft started taking Linux users to court with claims of
stolen code. <br>
They also entered the Linux market with thier own
products. This one-two <br>
punch has discouraged most open-source
programmers and things look<br>
bleak.
You suspect their compressor uses some assembler code you wrote.<br>
You are about to update the code and want to insert a marker
that would<br>
destroy Microsoft if they borrowed your update.
Your first attempt displayed<br>
a "(" that would not be noticed on the Microsoft compressor screen.
After<br>
&nbsp;some testing, you
decided displaying a "1" would be better. <br>
      <br>
How would you modify the following code fragement by one byte to
show a "1"?<br>
      <br>
&nbsp;call label <br>
&nbsp;push -1014969024 <br>
label: lea ebp,[$ + 8]<br>
&nbsp;call ebp<br>
&nbsp;sub ebx,ebx<br>
&nbsp;inc ebx <br>
&nbsp;pop ecx<br>
&nbsp;mov edx,ebx<br>
&nbsp;mov eax,edx<br>
&nbsp; inc eax <br>
&nbsp; inc eax<br>
&nbsp; sub ebp,byte 12<br>
&nbsp; pop esi<br>
&nbsp; call ebp <br>
      <br>
&nbsp;<a href="#Microsoft_Attacks">see answer</a><br>
      <br>
      </style="font-weight:>
      <hr style="width: 100%; height: 2px;">Answers to
puzzles<br>
      <hr style="width: 100%; height: 2px;"><br>
      <br>
Answer to Classical Puzzle 1 - <a name="Doubly_linked_list"></a>Doubly
linked list<br>
      <br>
There are several answers to this puzzle.&nbsp; A good discussion of
the techniques can be found at
http://en/wikipedia.org/wiki/Wike/Xor_linked_list<br>
      <br>
The answer using a Xor linked list<br>
      <br>
; input edi=current list position<br>
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; esi=previous
list position or zero if at start<br>
; output eax = next link position<br>
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
edi,esi unchanged<br>
traverse:<br>
&nbsp; xor eax,eax<br>
&nbsp; or&nbsp;&nbsp; esi,esi<br>
&nbsp; jz&nbsp;&nbsp;&nbsp; tr_10<br>
&nbsp; mov eax,esi<br>
tr_10:<br>
&nbsp; xor eax,[edi]<br>
&nbsp; ret<br>
      <br>
      <br>
Answer to Classical Puzzle 2 - <a name="Shared_Memory"></a>Shared
Memory<br>
      <br>
semaphores on a single cpu system can often be implemented
with a single xchg or cmpxchg instruction.&nbsp; The tricky part of
this puzzle was writting the shortest code.&nbsp; Here is the answer:<br>
      <br>
&nbsp; mov&nbsp; ecx,1<br>
&nbsp; xchg ecx,[semaphore]<br>
&nbsp; jecxz got_semaphore<br>
&nbsp; <br>
If the xchg returns 0 then the flag previously zero and is now one.<br>
if the xchg returns 1 then the flag was set previously and is still set<br>
      <hr style="width: 100%; height: 2px;"><br>
Answer to Guru Puzzle 1 - <a name="Ascii_Conversion_"></a>Ascii
Conversion<br>
      <br>
Conversion of a register to a decimal ascii string is
easy.&nbsp; Just keep dividing by 10 and storing the result until the
value goes negative.&nbsp; The tricky part is doing it in the fewest
bytes of code.&nbsp; Our answer uses<br>
recursion and the stack to put output in correct order.<br>
      <br>
; input<br>
;&nbsp; eax=register to convert<br>
;&nbsp; edi =storage pointer for ascii string<br>
convert:<br>
&nbsp; push&nbsp; byte 10<br>
&nbsp; pop&nbsp; ecx<br>
recurse:<br>
&nbsp; xor edx,edx<br>
&nbsp; div&nbsp; ecx<br>
&nbsp; push edx<br>
&nbsp; or&nbsp; eax,eax<br>
&nbsp; jz&nbsp;&nbsp;&nbsp; store<br>
&nbsp; call&nbsp; recurse<br>
store:<br>
&nbsp; pop&nbsp; eax<br>
&nbsp; or&nbsp; al,30h<br>
&nbsp; stosb<br>
&nbsp; ret<br>
      <br>
The above code should compile to 22 bytes.<br>
      <hr style="width: 100%; height: 2px;"><br>
Answer to Guru Puzzle 2 - <a name="shortest_sort"></a>shortest
sort<br>
      <br>
The bubble sort is the simplest sort.&nbsp; We just keep
exchange
entries if in wrong order until the list is sorted.&nbsp;&nbsp; This
code works back from the end of array.<br>
      <br>
;input: ecx = number of array elements (dword array)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edi =
array pointer<br>
sort:<br>
&nbsp; lea ebx,[edi+ecx*4]<br>
&nbsp; mov&nbsp; eax,[edx]<br>
cmploop:<br>
&nbsp; lea ebx,[ebx-4]<br>
&nbsp; cmp&nbsp; eax,[ebx]<br>
&nbsp; jle&nbsp; notyet<br>
&nbsp; xchg eax,[ebx]<br>
notyet:<br>
&nbsp; cmp&nbsp; ebx,edi<br>
&nbsp; jnz&nbsp; cmploop<br>
&nbsp; stosd<br>
&nbsp; loop sort<br>
&nbsp; ret<br>
      <br>
This should compile to 22 bytes or less<br>
      <hr style="width: 100%; height: 2px;"><br>
      <style="font-weight: bold;="">Answer to Guru Puzzle 3 - <a
 name="Bill_Gates_Puzzle"></a>Bill Gates Puzzle<br>
      <br>
To generate -4 using using two bytes use "int byte 80h" .&nbsp; This
calls kernel function<br>
zero which returns error -4<br>
      <br>
      <br>
      <style="font-weight: bold;="">Answer to Guru Puzzle 4 - <a
 name="Microsoft_Attacks"></a>Microsoft Attracks<br>
      <br>
To display a "1"&nbsp; change the instruction "sub ebx,ebx"
to<br>
"xor ebx,ebx"<br>
      <br>
      </style="font-weight:></style="font-weight:>
      <hr style="width: 100%; height: 2px;"><br>
      <br>
Got a better Solution?<br>
Did I type the answer in&nbsp; wrong?<br>
      <br>
Email solution to:&nbsp; jko at bsn1 dot net<br>
or send questions, complaints, doubts, etc. to the discussion group<br>
DesktopLinuxAsm@yahoogroups.com<br>
join or view past messages at: <a
 href="http://groups.yahoo.com/group/DesktopLinuxAsm">yahoo</a><br>
&nbsp; http://groups.yahoo.com/group/DesktopLinuxAsm<br>
      <br>
<!-- END of the content cell --></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      <br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<!-- bottom page info here or in the content cell -->
<hr class="content" noshade="noshade">
<div class="menubottom" align="center"><br>
<em>Last Updated: December 13, 2008</em></div>

</body>
</html>
